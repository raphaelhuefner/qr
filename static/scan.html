<!DOCTYPE html>
<html>

<head>
    <link
        href="data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEhEQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP7/AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA"
        rel="icon" type="image/x-icon">
    <script src="html5-qrcode.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="spectre.min.css">
    <link rel="stylesheet" href="spectre-exp.min.css">
    <link rel="stylesheet" href="spectre-icons.min.css">
    <style>
        .row-1 {
            height: 50%;
        }

        .row-2 {
            height: 20%;
        }

        #reader video {
            transform: scale(-1, 1);
        }

        #output {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div class="container row-1">
        <div class="columns col-gapless">
            <div class="column col-3"></div>
            <div class="column col-6" id="reader"></div>
            <div class="column col-3"></div>
        </div>
    </div>
    <div class="container row-2">
        <div class="columns col-gapless">
            <div class="column col-3"></div>
            <div class="column col-6">
                <textarea id="output"></textarea>
            </div>
            <div class="column col-3"></div>
        </div>
    </div>

    <script type="text/javascript">
        let lastDecodedText = '';

        const output = document.getElementById('output');

        function writeOutput(text) {
            output.innerText = text;
        }

        function onScanSuccess(decodedText, decodedResult) {
            if (decodedText != lastDecodedText) {
                console.log(`Code matched = ${decodedText}`, decodedResult);
                writeOutput(decodedText);
            }
        }

        function onScanFailure(error) {
            // handle scan failure.
            // usually better to ignore and keep scanning.
            console.warn(`Code scan error = ${error}`);
        }

        function qrboxFunction(viewfinderWidth, viewfinderHeight) {
            const shortestEdge = Math.min(viewfinderWidth, viewfinderHeight);
            const qrboxFraction = 0.7;
            const qrboxSize = Math.floor(shortestEdge * qrboxFraction);
            return {
                width: qrboxSize,
                height: qrboxSize
            };
        }

        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader",
            { fps: 5, qrbox: qrboxFunction },
            /* verbose= */ false
        );
        html5QrcodeScanner.render(onScanSuccess, onScanFailure);

        // Html5Qrcode.getCameras().then(devices => {
        //     /**
        //      * devices would be an array of objects of type:
        //      * { id: "id", label: "label" }
        //      */
        //     if (devices && devices.length) {
        //         console.log(devices);

        //         // for (const d of devices) {
        //         // }
        //         // var cameraId = devices[0].id;
        //         // // .. use this to start scanning.
        //     }
        // }).catch(err => {
        //     console.warn(`Error with getCameras():`);
        //     console.warn(err);
        // });


    </script>

</body>

</html>